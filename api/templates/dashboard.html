<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Monitoreo Adultos Mayores</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f9fafb;
            margin: 0;
        }
        header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        header .user {
            font-size: 0.9rem;
            color: #6b7280;
        }
        header a {
            margin-left: 1rem;
            text-decoration: none;
            color: #ef4444;
            font-size: 0.9rem;
        }
        main {
            padding: 1.5rem 2rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.04);
        }
        th, td {
            padding: 0.75rem 0.9rem;
            text-align: left;
            font-size: 0.9rem;
        }
        th {
            background: #f3f4f6;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-on {
            background: #dcfce7;
            color: #166534;
        }
        .badge-off {
            background: #fee2e2;
            color: #991b1b;
        }
        .alert {
            color: #b91c1c;
            font-weight: 600;
        }
        .ok {
            color: #166534;
        }
        .subtitle {
            margin-bottom: 0.75rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
<header>
    <div>
        <h1>Panel de monitoreo</h1>
        <div class="subtitle">Ãšltimas lecturas por paciente</div>
    </div>
    <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="{{ url_for('semaforo') }}" 
           style="background: #2563eb; color: white; padding: 0.5rem 1rem; 
                  text-decoration: none; border-radius: 0.5rem; font-size: 0.9rem;">
            ðŸ“Š Ver SemÃ¡foro de Estado
        </a>
        <div class="user">
            SesiÃ³n: {{ username }} |
            <a href="{{ url_for('logout') }}">Cerrar sesiÃ³n</a>
        </div>
    </div>
</header>

<main>
    {% if pacientes|length == 0 %}
        <p>No hay pacientes registrados o aÃºn no hay lecturas.</p>
    {% else %}
    <table>
        <thead>
        <tr>
            <th>ID Paciente</th>
            <th>Nombre</th>
            <th>Edad</th>
            <th>ID Pulsera</th>
            <th>Temp (Â°C)</th>
            <th>Ritmo (lpm)</th>
            <th>Pulsera</th>
            <th>Ãšltima lectura</th>
        </tr>
        </thead>
        <tbody>
        {% for p in pacientes %}
            {% set temp = p.temperatura_c %}
            {% set ritmo = p.ritmo_cardiaco %}
            {% set temp_alert = temp is not none and (temp < 36 or temp > 38) %}
            {% set ritmo_alert = ritmo is not none and (ritmo < 50 or ritmo > 110) %}
        <tr>
            <td>{{ p.id_paciente }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.edad if p.edad is not none else "-" }}</td>
            <td>{{ p.id_pulsera }}</td>
            <td class="{{ 'alert' if temp_alert else 'ok' if temp is not none else '' }}">
                {{ temp if temp is not none else "-" }}
            </td>
            <td class="{{ 'alert' if ritmo_alert else 'ok' if ritmo is not none else '' }}">
                {{ ritmo if ritmo is not none else "-" }}
            </td>
            <td>
                {% if p.esta_puesta %}
                    <span class="badge badge-on">Puesta</span>
                {% elif p.esta_puesta is not none %}
                    <span class="badge badge-off">No puesta</span>
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ p.momento_lectura if p.momento_lectura else "-" }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}
</main>
</body>
</html>

