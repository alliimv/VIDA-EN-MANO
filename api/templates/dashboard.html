<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dashboard - Vida en Mano</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--bg:#f5f8fb;--card:#fff;--muted:#6b7280;--accent:#2463eb;--success:#10b981;--danger:#ef4444;--shadow:0 10px 24px rgba(2,6,23,0.06);--radius:12px}
        *{box-sizing:border-box}
        body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);color:#0f172a}
        .topbar{display:flex;justify-content:space-between;align-items:center;padding:18px 28px;background:linear-gradient(90deg,var(--accent),#0b57c8);color:#fff}
        .brand{display:flex;align-items:center;gap:12px;font-weight:700}
        .container{max-width:1100px;margin:26px auto;padding:0 16px}
        .grid-2{display:grid;grid-template-columns:1fr 360px;gap:18px}
        .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
        .welcome{display:flex;gap:14px;align-items:center}
        .welcome .title{font-size:1.25rem;font-weight:700}
        .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
        .stat{display:flex;gap:12px;align-items:center;padding:14px;border-radius:10px}
        .stat .icon{width:48px;height:48;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff}
        .icon.p{background:linear-gradient(135deg,#4f46e5,#1e40af)}.icon.c{background:linear-gradient(135deg,#ef4444,#fb7185)}.icon.s{background:linear-gradient(135deg,#10b981,#34d399)}
        .lower{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin-top:16px}
        ul.clean{list-style:none;margin:0;padding:0}
        ul.clean li{padding:10px;border-radius:8px;background:#fff;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
        a.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none;font-weight:600}
        .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
        @media (max-width:900px){.grid-2{grid-template-columns:1fr}.stats{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <header class="topbar">
        <div class="brand"><i class="fas fa-heartbeat"></i><div>Vida en Mano</div></div>
        <div style="display:flex;align-items:center;gap:12px">
            <div style="text-align:right">
                <div style="font-weight:700">{{ username }}</div>
                <div style="font-size:0.85rem;color:rgba(255,255,255,0.9);text-transform:capitalize">{{ user_role }}</div>
            </div>
            <a href="{{ url_for('logout') }}" class="btn">Cerrar sesi√≥n</a>
        </div>
    </header>

    <main class="container">
        <section class="grid-2">
            <div>
                <div class="card welcome">
                    <div style="font-size:34px">üè•</div>
                    <div>
                        <div class="title">Hola, {{ username }} üëã</div>
                        <div style="color:var(--muted);margin-top:6px">Panel para supervisar residentes y ver alertas recientes.</div>
                        <div class="actions">
                            <a class="btn" href="{{ url_for('ver_pacientes') }}">Ver Residentes</a>
                            <a class="btn" href="{{ url_for('semaforo') }}" style="background:#f97316">Sem√°foro</a>
                            <a class="btn" href="{{ url_for('mi_perfil') }}" style="background:#7c3aed">Mi Perfil</a>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="card stat" style="align-items:center">
                        <div class="icon p"><i class="fas fa-users"></i></div>
                        <div>
                            <div style="font-weight:800;font-size:1.2rem">{{ total_pacientes }}</div>
                            <div style="color:var(--muted)">Total residentes</div>
                        </div>
                    </div>

                    <div class="card stat">
                        <div class="icon c"><i class="fas fa-triangle-exclamation"></i></div>
                        <div>
                            <div style="font-weight:800;font-size:1.2rem">{{ criticos }}</div>
                            <div style="color:var(--muted)">En estado cr√≠tico</div>
                        </div>
                    </div>

                    <div class="card stat">
                        <div class="icon s"><i class="fas fa-heart-circle-plus"></i></div>
                        <div>
                            <div style="font-weight:800;font-size:1.2rem">{{ estables }}</div>
                            <div style="color:var(--muted)">Estables</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top:16px">
                    <h4 style="margin:0 0 8px 0">Tendencia (√∫ltimos 7 d√≠as)</h4>
                    <div style="height:250px">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

            <aside>
                <div class="card">
                    <h4 style="margin-top:0">Top residentes</h4>
                    {% if top_residentes and top_residentes|length > 0 %}
                        <ul class="clean">
                        {% for t in top_residentes %}
                            <li>
                                <div>
                                    <div style="font-weight:700"><a href="{{ url_for('historial_paciente', id_paciente=t.id_paciente) }}" style="text-decoration:none;color:inherit">#{{ t.id_paciente }} - {{ t.nombre }}</a></div>
                                    <div style="color:var(--muted);font-size:0.9rem">Pulsera: {{ t.id_pulsera }}</div>
                                </div>
                                <div>
                                    {% if t.estado == 'Cr√≠tico' %}
                                        <span style="background:#fee2e2;color:#991b1b;padding:6px 10px;border-radius:999px;font-weight:700">Cr√≠tico</span>
                                    {% elif t.estado == 'Estable' %}
                                        <span style="background:#ecfdf5;color:#065f46;padding:6px 10px;border-radius:999px;font-weight:700">Estable</span>
                                    {% else %}
                                        <span style="background:#f8fafc;color:#374151;padding:6px 10px;border-radius:999px;font-weight:700">{{ t.estado }}</span>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <div style="color:var(--muted)">No hay residentes destacados</div>
                    {% endif %}

                    <div style="text-align:right;margin-top:10px"><a href="{{ url_for('ver_pacientes') }}" class="btn">Ver todos</a></div>
                </div>

                <div class="card" style="margin-top:12px;text-align:center">
                    <div style="color:var(--muted);font-size:0.95rem">Soporte</div>
                    <div style="font-weight:700;margin-top:6px">soporte@vidaenmano.example</div>
                </div>
            </aside>
        </section>

        <footer style="margin-top:22px;text-align:center;color:var(--muted)">
            Vida en Mano ¬∑ Sistema de monitoreo ¬© {{ now().year }}
        </footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        (function(){
            const labels = {{ trend_labels | tojson | safe }};
            const criticos = {{ trend_criticos | tojson | safe }};
            const estables = {{ trend_estables | tojson | safe }};
            const ctx = document.getElementById('trendChart');
            if(!ctx) return;
            new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: [
                    { label: 'Cr√≠ticos', data: criticos, borderColor: '#ef4444', backgroundColor: 'rgba(239,68,68,0.12)', tension:0.3, pointRadius:3 },
                    { label: 'Estables', data: estables, borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.12)', tension:0.3, pointRadius:3 }
                ]},
                options:{responsive:true,plugins:{legend:{position:'top'}},scales:{y:{beginAtZero:true}}}
            });
        })();
    </script>
</body>
</html>
