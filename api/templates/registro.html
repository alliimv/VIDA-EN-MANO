<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro | Vida en Mano</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .register-box { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        h2 { text-align: center; color: #333; margin-bottom: 25px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; color: #555; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: #10b981; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0da271; }
        .error { background: #fee; color: #c33; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .links { text-align: center; margin-top: 20px; }
        a { color: #3b82f6; text-decoration: none; }
        .info-box { background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #3b82f6; }
        .paciente-option { display: flex; justify-content: space-between; padding: 8px 0; }
    </style>
</head>
<body>
    <div class="register-box">
        <h2>üìù Crear Nueva Cuenta</h2>

        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('registro') }}">
            <!-- Informaci√≥n b√°sica -->
            <div class="input-group">
                <label for="nombre_completo">Nombre Completo:</label>
                <input type="text" id="nombre_completo" name="nombre_completo"
                       placeholder="Ej: Juan P√©rez Garc√≠a" required>
            </div>

            <div class="input-group">
                <label for="username">Nombre de Usuario:</label>
                <input type="text" id="username" name="username"
                       placeholder="Ej: juan.perez" required>
            </div>

            <div class="input-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" id="password" name="password"
                       placeholder="M√≠nimo 6 caracteres" required minlength="6">
            </div>

            <div class="input-group">
                <label for="confirm_password">Confirmar Contrase√±a:</label>
                <input type="password" id="confirm_password" name="confirm_password" required>
            </div>

            <!-- Tipo de Usuario (SOLO dos opciones) -->
            <div class="input-group">
                <label for="tipo_usuario">Tipo de Usuario:</label>
                <select id="tipo_usuario" name="tipo_usuario" required onchange="togglePacienteField()">
                    <option value="">-- Selecciona tu tipo --</option>
                    <option value="enfermero">üë©‚Äç‚öïÔ∏è Enfermero/a (Acceso completo a TODOS)</option>
                    <option value="familiar">üë™ Familiar Autorizado (Solo UN paciente)</option>
                </select>
            </div>

            <!-- Informaci√≥n para familiares -->
            <div id="familiar-fields" style="display: none;">
                <div class="info-box">
                    <strong>üìã Para familiares:</strong> Solo podr√°s ver UN paciente espec√≠fico.
                </div>

                <div class="input-group">
                    <label for="id_paciente">Paciente Asignado:</label>
                    <select id="id_paciente" name="id_paciente">
                        <option value="">-- Selecciona un paciente --</option>
                        {% if pacientes and pacientes|length > 0 %}
                            {% for paciente in pacientes %}
                            <div class="paciente-option">
                                <option value="{{ paciente.id_paciente }}">
                                    {{ paciente.nombre }} {{ paciente.apellido_paterno }}
                                    {{ paciente.apellido_materno or '' }}
                                </option>
                            </div>
                            {% endfor %}
                        {% else %}
                            <option value="" disabled>No hay pacientes disponibles</option>
                        {% endif %}
                    </select>
                    {% if not pacientes or pacientes|length == 0 %}
                    <small style="color: #dc2626;">
                        ‚ö†Ô∏è No hay pacientes registrados. Primero registra un paciente.
                    </small>
                    {% endif %}
                </div>

                <div class="input-group">
                    <label for="parentesco">Parentesco:</label>
                    <input type="text" id="parentesco" name="parentesco"
                           placeholder="Ej: Hijo/a, Esposo/a, Hermano/a, Padre, Madre">
                </div>
            </div>

            <button type="submit">‚úÖ Crear Cuenta</button>
        </form>

        <div class="links">
            <p>¬øYa tienes cuenta? <a href="{{ url_for('home') }}">Inicia sesi√≥n aqu√≠</a></p>
            <p><a href="{{ url_for('mi_perfil') }}">Ver perfil p√∫blico</a></p>
        </div>
    </div>

    <script>
        function togglePacienteField() {
            const tipoUsuario = document.getElementById('tipo_usuario').value;
            const familiarFields = document.getElementById('familiar-fields');

            if (tipoUsuario === 'familiar') {
                familiarFields.style.display = 'block';
                document.getElementById('id_paciente').required = true;
                document.getElementById('parentesco').required = true;
            } else {
                familiarFields.style.display = 'none';
                document.getElementById('id_paciente').required = false;
                document.getElementById('parentesco').required = false;
            }
        }

        // Inicializar al cargar
        document.addEventListener('DOMContentLoaded', function() {
            togglePacienteField();
        });
    </script>
</body>
</html>